{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { environment } from 'src/environments/environment';\nimport { map, switchMap } from 'rxjs/operators';\nimport { of } from 'rxjs'; //para observable\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/fire/compat/auth\";\nimport * as i3 from \"@angular/fire/compat/firestore\";\nconst URL = environment.spotiUrl;\nexport class SpotifyService {\n  ///////////////////////////// API\n  constructor(http,\n  //autenticar usuario\n  afAuth,\n  //manipular db\n  firestore) {\n    this.http = http;\n    this.afAuth = afAuth;\n    this.firestore = firestore;\n  }\n  //METODO QUE REUTILIZAREMOS PARA ABREVIAR OTROS METODOS, URL SPOTIFY   \n  getQuery(query) {\n    const headers = new HttpHeaders({\n      'Authorization': 'Bearer BQDLLY7aa2w7KvFdxE8mydUAaId9Z-n194lq6xnzxku_dgucaRSwZtyZYxXrtw74tKk2hIU6fU-QyM4b2MW4_2YgNfEIpJkbKaW3YiYZfbDSSuf9fzY'\n    });\n    return this.http.get(`${URL}/${query}`, {\n      headers\n    });\n  }\n  //METODO NUEVOS ALBUMES\n  getNewReleases() {\n    return this.getQuery('browse/new-releases?limit=24').pipe(map(res => {\n      return res.albums.items;\n    }));\n  }\n  //METODO ARTISTAS, PORTADAS, ETC\n  getArtistas(termino) {\n    return this.getQuery(`search?query=${termino}&type=artist&market=es&limit=15`).pipe(map(res => {\n      return res.artists.items;\n    }));\n  }\n  //METODO PERFIL ARTISTA\n  getInfoArtista(id) {\n    return this.getQuery(`artists/${id}`);\n  }\n  //METODO TRACKS\n  getTopTracks(id) {\n    return this.getQuery(`artists/${id}/top-tracks?market=es`).pipe(map(res => {\n      return res.tracks;\n    }));\n  }\n  getUsuario() {\n    return this.afAuth.authState.pipe(map(user => user?.uid));\n  }\n  addFavoriteArtist(artista) {\n    return this.getUsuario().pipe(switchMap(uid => {\n      if (uid) {\n        const userRef = this.firestore.collection('users').doc(uid);\n        return userRef.collection('favorites').doc('artists').set({\n          [artista.id]: artista\n        }, {\n          merge: true\n        });\n      } else {\n        return of(null);\n      }\n    })).toPromise();\n  }\n  addFavoriteAlbum(album) {\n    return this.getUsuario().pipe(switchMap(uid => {\n      if (uid) {\n        const userRef = this.firestore.collection('users').doc(uid);\n        return userRef.collection('favorites').doc('albums').set({\n          [album.id]: album\n        }, {\n          merge: true\n        });\n      } else {\n        return of(null);\n      }\n    })).toPromise();\n  }\n  addFavoriteTrack(track) {\n    return this.getUsuario().pipe(switchMap(uid => {\n      if (uid) {\n        const userRef = this.firestore.collection('users').doc(uid);\n        return userRef.collection('favorites').doc('tracks').set({\n          [track.id]: track\n        }, {\n          merge: true\n        });\n      } else {\n        return of(null);\n      }\n    })).toPromise();\n  }\n  getFavorites() {\n    return this.getUsuario().pipe(switchMap(uid => {\n      if (uid) {\n        const userRef = this.firestore.collection('users').doc(uid);\n        return userRef.collection('favorites').valueChanges();\n      } else {\n        return of(null);\n      }\n    }));\n  }\n  static #_ = this.ɵfac = function SpotifyService_Factory(t) {\n    return new (t || SpotifyService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.AngularFireAuth), i0.ɵɵinject(i3.AngularFirestore));\n  };\n  static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: SpotifyService,\n    factory: SpotifyService.ɵfac,\n    providedIn: 'root'\n  });\n}","map":{"version":3,"names":["HttpHeaders","environment","map","switchMap","of","URL","spotiUrl","SpotifyService","constructor","http","afAuth","firestore","getQuery","query","headers","get","getNewReleases","pipe","res","albums","items","getArtistas","termino","artists","getInfoArtista","id","getTopTracks","tracks","getUsuario","authState","user","uid","addFavoriteArtist","artista","userRef","collection","doc","set","merge","toPromise","addFavoriteAlbum","album","addFavoriteTrack","track","getFavorites","valueChanges","_","i0","ɵɵinject","i1","HttpClient","i2","AngularFireAuth","i3","AngularFirestore","_2","factory","ɵfac","providedIn"],"sources":["C:\\Users\\ASUS\\Documents\\GitHub\\ProAsix\\src\\app\\services\\spotify.service.ts"],"sourcesContent":["import { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { environment } from 'src/environments/environment';\r\nimport { map, switchMap } from 'rxjs/operators'\r\n\r\nimport { AngularFireAuth } from '@angular/fire/compat/auth'\r\nimport { AngularFirestore, AngularFirestoreDocument } from '@angular/fire/compat/firestore'\r\nimport { of } from 'rxjs'; //para observable\r\n\r\n\r\nconst URL = environment.spotiUrl\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class SpotifyService {\r\n  ///////////////////////////// API\r\n  constructor(\r\n    private http:HttpClient,\r\n\r\n    //autenticar usuario\r\n    private afAuth: AngularFireAuth,\r\n    //manipular db\r\n    private firestore: AngularFirestore,\r\n\r\n  ) { }\r\n  //METODO QUE REUTILIZAREMOS PARA ABREVIAR OTROS METODOS, URL SPOTIFY   \r\n  getQuery(query:string ){\r\n    const headers = new HttpHeaders({\r\n      'Authorization' : 'Bearer BQDLLY7aa2w7KvFdxE8mydUAaId9Z-n194lq6xnzxku_dgucaRSwZtyZYxXrtw74tKk2hIU6fU-QyM4b2MW4_2YgNfEIpJkbKaW3YiYZfbDSSuf9fzY'   \r\n    });\r\n    return this.http.get(`${URL}/${query}`, {headers})\r\n  }\r\n\r\n  //METODO NUEVOS ALBUMES\r\n  getNewReleases (){\r\n    return this.getQuery('browse/new-releases?limit=24').pipe(\r\n      map((res:any)=>{\r\n        return res.albums.items;\r\n      })\r\n    );\r\n  }\r\n\r\n  //METODO ARTISTAS, PORTADAS, ETC\r\n  getArtistas(termino:string){\r\n    return this.getQuery(`search?query=${termino}&type=artist&market=es&limit=15`).pipe(\r\n      map((res:any)=>{\r\n        return res.artists.items;\r\n      })\r\n    );\r\n  }\r\n    \r\n  //METODO PERFIL ARTISTA\r\n  getInfoArtista(id:string){\r\n    return this.getQuery(`artists/${id}`)\r\n  }\r\n\r\n  //METODO TRACKS\r\n  getTopTracks(id:string) {\r\n    return this.getQuery(`artists/${id}/top-tracks?market=es`).pipe(\r\n      map((res:any)=>{\r\n        return res.tracks;\r\n      })\r\n    );\r\n  }\r\n\r\n  private getUsuario() {\r\n    return this.afAuth.authState.pipe(map(user => user?.uid));\r\n  }\r\n\r\n  addFavoriteArtist(artista: any) {\r\n    return this.getUsuario().pipe(\r\n      switchMap(uid => {\r\n        if (uid) {\r\n          const userRef = this.firestore.collection('users').doc(uid);\r\n          return userRef.collection('favorites').doc('artists').set({\r\n            [artista.id]: artista\r\n          }, { merge: true });\r\n        } else {\r\n          return of(null);\r\n        }\r\n      })\r\n    ).toPromise();\r\n  }\r\n\r\n  addFavoriteAlbum(album: any) {\r\n    return this.getUsuario().pipe(\r\n      switchMap(uid => {\r\n        if (uid) {\r\n          const userRef = this.firestore.collection('users').doc(uid);\r\n          return userRef.collection('favorites').doc('albums').set({\r\n            [album.id]: album\r\n          }, { merge: true });\r\n        } else {\r\n          return of(null);\r\n        }\r\n      })\r\n    ).toPromise();\r\n  }\r\n\r\n  addFavoriteTrack(track: any) {\r\n    return this.getUsuario().pipe(\r\n      switchMap(uid => {\r\n        if (uid) {\r\n          const userRef = this.firestore.collection('users').doc(uid);\r\n          return userRef.collection('favorites').doc('tracks').set({\r\n            [track.id]: track\r\n          }, { merge: true });\r\n        } else {\r\n          return of(null);\r\n        }\r\n      })\r\n    ).toPromise();\r\n  }\r\n\r\n  getFavorites() {\r\n    return this.getUsuario().pipe(\r\n      switchMap(uid => {\r\n        if (uid) {\r\n          const userRef = this.firestore.collection('users').doc(uid);\r\n          return userRef.collection('favorites').valueChanges();\r\n        } else {\r\n          return of(null);\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n\r\n\r\n\r\n} \r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}